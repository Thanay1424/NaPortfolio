<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pizza Order – Builder Pattern Demo</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--muted:#1f2937;--text:#e5e7eb;--sub:#94a3b8;--accent:#22c55e;--accent2:#6366f1;--danger:#ef4444;}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
  body{margin:0;background:linear-gradient(180deg,#0b1224, #0f172a 30%, #0b1224);color:var(--text);display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px}
  .container{width:100%;max-width:1100px;display:grid;gap:20px;grid-template-columns:1.2fr .8fr}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
  .hdr{padding:18px 20px;background:linear-gradient(90deg,#111827,#0b1224);border-bottom:1px solid #1f2937;display:flex;align-items:center;gap:10px}
  .hdr h2{margin:0;font-size:18px;font-weight:700;letter-spacing:.3px}
  .body{padding:20px}
  fieldset{border:1px solid #263044;margin:0 0 18px;border-radius:14px;padding:12px 14px}
  legend{padding:0 8px;color:var(--sub);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
  label{display:block;margin:8px 0;color:var(--text)}
  .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .muted{color:var(--sub);font-size:13px}
  select, input[type="text"]{width:100%;padding:10px 12px;background:#0b1224;border:1px solid #263044;border-radius:12px;color:var(--text);outline:none}
  .chips{display:flex;flex-wrap:wrap;gap:10px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #263044;border-radius:999px;background:#0b1224;cursor:pointer;user-select:none}
  .chip input{accent-color:#16a34a}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  button{border:0;border-radius:14px;padding:12px 14px;font-weight:700;cursor:pointer}
  .primary{background:linear-gradient(90deg,#22c55e,#16a34a);color:#03240f}
  .ghost{background:#0b1224;color:var(--text);border:1px solid #263044}
  .danger{background:linear-gradient(90deg,#ef4444,#dc2626);color:#2a0909}
  .summary{display:grid;gap:14px}
  .pill{display:inline-flex;gap:10px;flex-wrap:wrap}
  .pill span{background:#0b1224;border:1px solid #263044;border-radius:999px;padding:6px 10px}
  .price{font-size:28px;font-weight:800}
  pre{margin:0;background:#0b1224;border:1px solid #263044;border-radius:12px;padding:12px;overflow:auto;max-height:260px}
  .badge{display:inline-flex;align-items:center;gap:6px;background:#0b1224;border:1px solid #263044;color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:12px}
  .footnote{font-size:12px;color:#9aa7b8}
  @media (max-width:980px){.container{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="container">
    <!-- FORM -->
    <div class="card">
      <div class="hdr"><h2>Build Your Pizza</h2><span class="badge">Builder Pattern</span></div>
      <div class="body">
        <form id="orderForm">
          <fieldset>
            <legend>Size</legend>
            <div class="row">
              <label>
                Size
                <select id="size">
                  <option value="Small">Small</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="Large">Large</option>
                  <option value="XL">XL</option>
                </select>
              </label>
              <label>
                Crust (optional)
                <select id="crust">
                  <option value="">—</option>
                  <option value="Thin">Thin</option>
                  <option value="Hand-Tossed">Hand-Tossed</option>
                  <option value="Cheese Burst">Cheese Burst</option>
                  <option value="Deep Dish">Deep Dish</option>
                </select>
              </label>
            </div>
            <p class="muted">Size drives base price; crust is optional and shows how Builder adds features without touching existing code.</p>
          </fieldset>

          <fieldset>
            <legend>Toppings</legend>
            <div class="chips" id="toppings">
              <!-- generated by JS -->
            </div>
          </fieldset>

          <fieldset>
            <legend>Add-ons</legend>
            <div class="chips" id="addons">
              <!-- generated by JS -->
            </div>
          </fieldset>

          <fieldset>
            <legend>Delivery Preferences</legend>
            <div class="row">
              <label>
                Delivery Type
                <select id="deliveryType">
                  <option value="Home Delivery" selected>Home Delivery</option>
                  <option value="Pickup">Pickup</option>
                  <option value="Dine-in">Dine-in</option>
                </select>
              </label>
              <label>
                Time Window (e.g. 7:30 PM)
                <input type="text" id="time" placeholder="Now / 7:30 PM / 20 min"/>
              </label>
              <label>
                Instructions (optional)
                <input type="text" id="instructions" placeholder="Ring bell twice, extra napkins..."/>
              </label>
            </div>
          </fieldset>

          <div class="actions">
            <button type="submit" class="primary">Add to Cart</button>
            <button type="button" class="ghost" id="previewBtn">Preview Build</button>
            <button type="reset" class="danger">Reset</button>
          </div>
        </form>
        <p class="footnote">Tip: Toggle toppings/add-ons freely—Builder keeps the object consistent until you call <code>.build()</code>.</p>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="card">
      <div class="hdr"><h2>Order Summary</h2></div>
      <div class="body summary">
        <div>
          <div class="muted">Pizza</div>
          <div id="pizzaTitle" style="font-weight:800;font-size:18px;">—</div>
        </div>
        <div>
          <div class="muted">Toppings</div>
          <div class="pill" id="toppingsList"></div>
        </div>
        <div>
          <div class="muted">Add-ons</div>
          <div class="pill" id="addonsList"></div>
        </div>
        <div>
          <div class="muted">Delivery</div>
          <div id="deliveryText">—</div>
        </div>
        <div>
          <div class="muted">Price</div>
          <div class="price" id="priceText">₹0</div>
        </div>
        <div>
          <div class="muted">Built Object (JSON)</div>
          <pre id="jsonOut">{}</pre>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- Product ---------- */
class Pizza {
  constructor({ size, crust, toppings, addons, delivery }) {
    this.size = size ?? null;
    this.crust = crust ?? null;
    this.toppings = toppings ?? [];
    this.addons = addons ?? [];
    this.delivery = delivery ?? null;
  }
}

/* ---------- Builder ---------- */
class PizzaBuilder {
  constructor() {
    this._size = null;
    this._crust = null;
    this._toppings = [];
    this._addons = [];
    this._delivery = null;
  }
  setSize(size){ this._size = size; return this; }
  setCrust(crust){ this._crust = crust || null; return this; } // optional feature
  addTopping(t){ if(t) this._toppings.push(t); return this; }
  addAddon(a){ if(a) this._addons.push(a); return this; }
  setDelivery({ type, time, instructions }){
    this._delivery = { type, time: time || null, instructions: instructions || null };
    return this;
  }
  reset(){ this.constructor.call(this); return this; }
  build(){
    if(!this._size) throw new Error("Size is required");
    return new Pizza({
      size: this._size,
      crust: this._crust,
      toppings: [...this._toppings],
      addons: [...this._addons],
      delivery: this._delivery
    });
  }
}

/* ---------- Pricing (example rules) ---------- */
const PRICE = {
  base: { Small: 199, Medium: 299, Large: 399, XL: 499 },
  crust: { "Cheese Burst": 70, "Deep Dish": 50, "Hand-Tossed": 20, "Thin": 0 },
  topping: 35,
  addon: 30,
  deliveryFee: { "Home Delivery": 25, "Pickup": 0, "Dine-in": 0 }
};
function calcPrice(pizza){
  let total = 0;
  total += PRICE.base[pizza.size] || 0;
  if (pizza.crust) total += PRICE.crust[pizza.crust] || 0;
  total += (pizza.toppings?.length || 0) * PRICE.topping;
  total += (pizza.addons?.length || 0) * PRICE.addon;
  total += PRICE.deliveryFee[pizza.delivery?.type] || 0;
  return total;
}

/* ---------- UI: dynamic options ---------- */
const TOPPING_OPTIONS = ["Cheese","Mushrooms","Onions","Tomatoes","Olives","Corn","Jalapeños","Paneer","Pepperoni"];
const ADDON_OPTIONS = ["Extra Cheese","Garlic Bread","Choco Lava","Cold Drink","Salad"];

function renderChips(list, containerId, name){
  const el = document.getElementById(containerId);
  el.innerHTML = "";
  list.forEach(item=>{
    const id = `${name}-${item.replace(/\s+/g,'').toLowerCase()}`;
    el.insertAdjacentHTML("beforeend", `
      <label class="chip" for="${id}">
        <input id="${id}" type="checkbox" value="${item}"/>
        <span>${item}</span>
      </label>
    `);
  });
}

/* ---------- UI helpers ---------- */
function rupee(n){ return "₹" + (n || 0).toLocaleString("en-IN"); }
function badgeList(el, items){
  el.innerHTML = items.length ? items.map(x=>`<span>${x}</span>`).join("") : "<span>None</span>";
}
function updateSummary(pizza){
  document.getElementById("pizzaTitle").textContent =
    `${pizza.size}${pizza.crust ? " • " + pizza.crust : ""}`;
  badgeList(document.getElementById("toppingsList"), pizza.toppings || []);
  badgeList(document.getElementById("addonsList"), pizza.addons || []);
  const d = pizza.delivery || {};
  document.getElementById("deliveryText").textContent =
    d.type ? `${d.type}${d.time ? " • " + d.time : ""}${d.instructions ? " • " + d.instructions : ""}` : "—";
  document.getElementById("priceText").textContent = rupee(calcPrice(pizza));
  document.getElementById("jsonOut").textContent = JSON.stringify(pizza, null, 2);
}

/* ---------- Build from form ---------- */
function buildFromForm(){
  const b = new PizzaBuilder();
  const size = document.getElementById("size").value;
  const crust = document.getElementById("crust").value;
  const deliveryType = document.getElementById("deliveryType").value;
  const time = document.getElementById("time").value.trim();
  const instructions = document.getElementById("instructions").value.trim();

  const toppingValues = [...document.querySelectorAll("#toppings input:checked")].map(i=>i.value);
  const addonValues = [...document.querySelectorAll("#addons input:checked")].map(i=>i.value);

  b.setSize(size);
  if (crust) b.setCrust(crust);             // optional without breaking existing code
  toppingValues.forEach(t=>b.addTopping(t));
  addonValues.forEach(a=>b.addAddon(a));
  b.setDelivery({ type: deliveryType, time, instructions });

  return b.build();
}

/* ---------- Bootstrap ---------- */
renderChips(TOPPING_OPTIONS, "toppings", "top");
renderChips(ADDON_OPTIONS, "addons", "add");

const form = document.getElementById("orderForm");
form.addEventListener("submit", (e)=>{
  e.preventDefault();
  try{
    const pizza = buildFromForm();
    updateSummary(pizza);
    // In a real app, we'd send `pizza` to the backend/cart service here.
    alert("Added to cart!");
  }catch(err){
    alert(err.message);
  }
});
document.getElementById("previewBtn").addEventListener("click", ()=>{
  try{ updateSummary(buildFromForm()); }catch(err){ alert(err.message); }
});
form.addEventListener("reset", ()=>setTimeout(()=>{
  updateSummary(new Pizza({ size:null, toppings:[], addons:[], delivery:null }));
}, 0));

/* initial summary */
updateSummary(new Pizza({ size:null, toppings:[], addons:[], delivery:null }));
</script>
</body>
</html>
